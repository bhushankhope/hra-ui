<form class="content" [formGroup]="visualizationForm" (ngSubmit)="onSubmit()" (keydown.enter)="$event.preventDefault()">
  <span class="title">Create a Cell Distance Visualization</span>

  <mat-card class="creation-step data">
    <mat-card-header>
      <mat-card-title>
        <div class="step-number">1</div>
        Format and Upload Data
      </mat-card-title>
    </mat-card-header>
    <mat-card-actions>
      <div class="left-side">
        <div class="column-content">
          <h2 class="subtitle">Upload Cell Type Table</h2>
          <div class="column-info">
            <div class="column-info-column">
              <span class="column-info-header">Required Columns</span>
              <span class="column-info-list">X, Y, and Cell Type</span>
            </div>
            <div class="column-info-column">
              <span class="column-info-header">Optional Columns</span>
              <span class="column-info-list">Z and Cell Ontology ID</span>
            </div>
          </div>
          @if (dataUploaded) {
            <div class="column-info-column">
              <span class="column-info-header">File loaded:</span>
              <span class="column-info-list">(file name)</span>
            </div>
            <button mat-button (click)="removeCSV()">Remove CSV</button>
          } @else {
            <button mat-button (click)="upload()">Upload CSV</button>
            <input
              #fileInput
              (change)="handleFile($event)"
              type="file"
              accept="text/csv"
              name="fileInput"
              id="fileInput"
              style="display: none"
            />
          }
        </div>
      </div>
      <div class="right-side">
        <div class="column-content">
          <h2 class="subtitle">Cell Type Table Template</h2>
          <button mat-button>Use Template -></button>
        </div>
      </div>
    </mat-card-actions>
  </mat-card>

  <mat-card class="creation-step anchor">
    <mat-card-header>
      <mat-card-title>
        <div class="step-number">2</div>
        Optional: Select Anchor Cell type
      </mat-card-title>
    </mat-card-header>
    <mat-card-actions>
      <mat-form-field>
        <mat-select [value]="visualizationForm.value.anchorCellType" formControlName="anchorCellType">
          @for (cell of cellTypes; track cell) {
            <mat-option [value]="cell.value">{{ cell.viewValue }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </mat-card-actions>
  </mat-card>

  <mat-card class="creation-step metadata" formGroupName="metadata">
    <mat-card-header>
      <mat-card-title>
        <div class="step-number">3</div>
        Add metadata
      </mat-card-title>
    </mat-card-header>
    <mat-card-actions>
      <div class="row-1">
        <div class="metadata-option">
          <span>Visualization Title</span>
          <mat-form-field>
            <input
              matInput
              placeholder="Title"
              [value]="visualizationForm.value.metadata ? visualizationForm.value.metadata.title : ''"
              formControlName="title"
            />
          </mat-form-field>
        </div>
        <div class="metadata-option">
          <span>Imaging Technology</span>
          <mat-form-field>
            <input
              matInput
              placeholder="Technology"
              [value]="visualizationForm.value.metadata ? visualizationForm.value.metadata.technology : ''"
              formControlName="technology"
            />
          </mat-form-field>
        </div>
        <div class="metadata-option">
          <span>Organ</span>
          <mat-form-field>
            <mat-select
              [value]="visualizationForm.value.metadata ? visualizationForm.value.metadata.organ : ''"
              placeholder="Organ"
              formControlName="organ"
            >
              <mat-option>None</mat-option>
              @for (organ of organs; track organ) {
                <mat-option [value]="organ.value">{{ organ.viewValue }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="row-2">
        <div class="metadata-option">
          <span>Sex</span>
          <mat-form-field>
            <mat-select
              [value]="visualizationForm.value.metadata ? visualizationForm.value.metadata.sex : ''"
              formControlName="sex"
            >
              @for (sex of sexes; track sex) {
                <mat-option [value]="sex.value">{{ sex.viewValue }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
        <div class="metadata-option">
          <span>Age</span>
          <mat-form-field>
            <input
              matInput
              type="number"
              placeholder="Age"
              [value]="visualizationForm.value.metadata ? visualizationForm.value.metadata.age : ''"
              formControlName="age"
            />
          </mat-form-field>
        </div>
        <div class="filler"></div>
      </div>

      <div class="row-3">
        <div class="metadata-option">
          <span>Thickness (um)</span>
          <mat-form-field>
            <input
              matInput
              type="number"
              placeholder="Thickness"
              [value]="visualizationForm.value.metadata ? visualizationForm.value.metadata.thickness : ''"
              formControlName="thickness"
            />
          </mat-form-field>
        </div>
        <div class="metadata-option">
          <span>Pixel size (um/pixel)</span>
          <mat-form-field>
            <input
              matInput
              type="number"
              placeholder="Pixel size"
              [value]="visualizationForm.value.metadata ? visualizationForm.value.metadata.pixelSize : ''"
              formControlName="pixelSize"
            />
          </mat-form-field>
        </div>
        <div class="filler"></div>
      </div>
    </mat-card-actions>
  </mat-card>

  <mat-card class="creation-step colors">
    <mat-card-header>
      <mat-card-title>
        <div class="step-number">4</div>
        Optional: Configure Color Map
      </mat-card-title>
    </mat-card-header>
    <mat-card-actions>
      <mat-button-toggle-group aria-label="Font Style" formControlName="colorMapOption">
        <mat-button-toggle value="default">Use Default Colors</mat-button-toggle>
        <mat-button-toggle value="custom">Upload Custom Color Map</mat-button-toggle>
      </mat-button-toggle-group>
    </mat-card-actions>
  </mat-card>

  <mat-card class="creation-step visualize">
    <mat-card-header>
      <mat-card-title>
        <div class="step-number">5</div>
        Visualize Cell Distance Data
      </mat-card-title>
    </mat-card-header>
    <mat-card-actions>
      <button type="submit" mat-button>Visualize</button>
    </mat-card-actions>
  </mat-card>
</form>
