<div class="scroll-wrapper">

  <div class="container">
    <div class='info-button-container'>
      <div>Author Data</div>
      <ccf-info-button videoID="gY3_-LIoKaU" infoTitle="CCF Registration User Interface" documentationUrl="assets/docs/README.md"></ccf-info-button>
    </div>

    <mat-expansion-panel class="registration-metadata-panel" [expanded]="false">
      <mat-expansion-panel-header class="header">
        <mat-panel-title matTooltip="">Registration Metadata</mat-panel-title>
      </mat-expansion-panel-header>

      <div>
        <h3>Author Data</h3>

        <ccf-name-input [name]="page.user$ | async" [middleNameEnabled]=true (nameChange)="page.setUserName($event); checkNameValid($event)">
        </ccf-name-input>
      </div>

      <div>
        <h3>Donor Data</h3>

        <div class="sex-toggle">
          <div class="label">Donor Sex: </div>
          <mat-radio-group class="radio-group" [value]="currentSex" (change)="setSexFromLabel($event.value)">
            <mat-radio-button class="radio" value="male">Male</mat-radio-button>
            <mat-radio-button class="radio" value="female">Female</mat-radio-button>
          </mat-radio-group>
        </div>

        <div class="organ-selector">
          <div class="label">Select an organ</div>
          <mat-form-field class="form-field" appearance="fill" subscriptSizing="dynamic">
            <div *ngIf="(model.organ$ | async) === undefined" class="label">Organs</div>
            <mat-select disableOptionCentering="true" panelClass="organ-select" [value]="model.organ$ | async"
              (selectionChange)="model.setOrgan($event.value)" hideSingleSelectionIndicator="true">
              <mat-option class="organ-select-option" *ngFor="let organ of organList" [value]="organ">
                {{organ.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

    </mat-expansion-panel>

    <ccf-block-size-input [blockSize]="model.blockSize$ | async" (blockSizeChange)="model.setBlockSize($event)">
    </ccf-block-size-input>


    <ccf-slices-input [slicesConfig]="model.slicesConfig$ | async" (slicesConfigChange)="model.setSlicesConfig($event)">
    </ccf-slices-input>

    <ccf-rotation-slider [rotation]="model.rotation$ | async" (rotationChange)="model.setRotation($event)">
    </ccf-rotation-slider>

    <mat-divider></mat-divider>
    <mat-expansion-panel class="tags-container" [expanded]="true">
      <mat-expansion-panel-header class="header">
        <mat-panel-title matTooltip="Review tags generated via collision detection. Add or delete tags as needed.">Anatomical Structure Tags</mat-panel-title>
      </mat-expansion-panel-header>

      <ccf-tag-search [search]="astags.searchExternal" (added)="astags.addTags($event)">
      </ccf-tag-search>

      <ccf-tag-list *ngIf="(model.organ$ | async)?.name; else: tagListPlaceholder" class="tag-list" [tags]="astags.tags$ | async"
                    (tagRemoved)="astags.removeTag($event)">
      </ccf-tag-list>
      <ng-template #tagListPlaceholder>
      </ng-template>

      <div class="legend">
        <span class="dot assigned"></span>
        <span class="text assigned">Assigned</span>
        <span class="dot added"></span>
        <span class="text added">Added</span>
      </div>
    </mat-expansion-panel>
    <mat-divider></mat-divider>

    <div class="filler"></div>

    <ccf-review-button class="review-button" [registrationCallbackSet]="page.registrationCallbackSet$ | async" [displayErrors]="registration.displayErrors$ | async"
                       [registrationIsValid]="registration.valid$ | async" [metaData]="(registration.metadata$ | async) ?? []"
                       (registerData)="registration.register()"
                       (enterErrorMode)="registration.setDisplayErrors(!registration.isValid)">
    </ccf-review-button>
  </div>
</div>
